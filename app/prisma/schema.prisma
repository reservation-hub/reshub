generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialActions"]
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_HOST")
}

enum Gender {
  MALE
  FEMALE
}

enum RoleSlug {
  ADMIN
  SHOP_STAFF
  CLIENT
}

enum ReservationStatus {
  CANCELLED
  COMPLETED
  RESERVED
}

enum Days {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique @db.VarChar(255)
  username     String?       @unique @db.VarChar(255)
  password     String        @db.VarChar(255)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  reservations Reservation[]
  oAuthIds     UserOAuthIds?
  profile      UserProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId    Int           @unique @map("profile_id")
  role         Role          @relation(fields: [roleId], references: [id])
  roleId       Int
  shopUser     ShopUser[]
}

model UserProfile {
  id             Int       @id @default(autoincrement())
  firstNameKanji String    @map("first_name_kanji") @db.VarChar(255)
  lastNameKanji  String    @map("last_name_kanji") @db.VarChar(255)
  firstNameKana  String    @map("first_name_kana") @db.VarChar(255)
  lastNameKana   String    @map("last_name_kana") @db.VarChar(255)
  phoneNumber    String?   @map("phone_number") @db.VarChar(15)
  address        String?   @db.VarChar(255)
  gender         Gender?
  birthday       DateTime? @db.Date
  user           User?
}

model UserOAuthIds {
  id         Int     @id @default(autoincrement())
  facebookId String? @unique @map("facebook_id")
  googleId   String? @unique @map("google_id")
  userId     Int     @unique @map("user_id")
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(32)
  description String   @db.VarChar(255)
  slug        RoleSlug @unique
  users       User[]
}

model Area {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(32)
  slug        String       @unique @db.VarChar(32)
  prefectures Prefecture[]
  shops       Shop[]
}

model Prefecture {
  id     Int    @id @default(autoincrement())
  name   String @db.VarChar(32)
  slug   String @unique @db.VarChar(32)
  areaId Int    @map("area_id")
  area   Area   @relation(fields: [areaId], references: [id])
  cities City[]
  shops  Shop[]
}

model City {
  id           Int        @id @default(autoincrement())
  name         String     @db.VarChar(32)
  prefectureId Int        @map("prefecture_id")
  slug         String     @unique
  prefecture   Prefecture @relation(fields: [prefectureId], references: [id])
  shops        Shop[]
}

model Shop {
  id           Int           @id @default(autoincrement())
  areaId       Int           @map("area_id")
  cityId       Int           @map("city_id")
  createdAt    DateTime      @default(now()) @map("created_at")
  prefectureId Int           @map("prefecture_id")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  area         Area          @relation(fields: [areaId], references: [id])
  city         City          @relation(fields: [cityId], references: [id])
  prefecture   Prefecture    @relation(fields: [prefectureId], references: [id])
  menu         Menu[]
  reservations Reservation[]
  shopDetail   ShopDetail    @relation(fields: [shopDetailId], references: [id], onDelete: Cascade)
  shopDetailId Int           @unique @map("shop_detail_id")
  stylists     Stylist[]
  shopUser     ShopUser?
}

model Menu {
  id          Int           @id @default(autoincrement())
  name        String        @db.VarChar(255)
  description String        @db.VarChar(255)
  price       Int
  duration    Int
  imageId     Int?          @unique @map("image_id")
  shopId      Int           @map("shop_id")
  image       ModelImage?   @relation(fields: [imageId], references: [id])
  shop        Shop          @relation(fields: [shopId], references: [id])
  Reservation Reservation[]
}

model ShopUser {
  id     Int  @id @default(autoincrement())
  shopId Int  @unique @map("shop_id")
  userId Int  @map("user_id")
  user   User @relation(fields: [userId], references: [id])
  shop   Shop @relation(fields: [shopId], references: [id])
}

model ShopDetail {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(255)
  address     String?      @db.VarChar(255)
  phoneNumber String?      @map("phone_number") @db.VarChar(255)
  shopId      Int?         @unique @map("shop_id")
  shop        Shop?
  details     String?      @db.VarChar(255)
  days        Days[]
  startTime   String       @map("start_time")
  endTime     String       @map("end_time")
  images      ModelImage[]
}

model ModelImage {
  id           Int         @id @default(autoincrement())
  imageId      Int         @unique @map("image_id")
  shopDetailId Int?        @map("shop_detail_id")
  stylistId    Int?        @unique
  image        Image       @relation(fields: [imageId], references: [id], onDelete: Cascade)
  shopDetail   ShopDetail? @relation(fields: [shopDetailId], references: [id], onDelete: Cascade)
  stylist      Stylist?    @relation(fields: [stylistId], references: [id], onDelete: Cascade)
  menu         Menu?
}

model Image {
  id         Int         @id @default(autoincrement())
  text       String      @db.VarChar(255)
  url        String      @db.VarChar(255)
  modelImage ModelImage?
}

model Stylist {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(28)
  image        ModelImage?
  reservations Reservation[]
  price        Int
  shopId       Int           @map("shop_id")
  shop         Shop          @relation(fields: [shopId], references: [id])
  days         Days[]
  startTime    String        @map("start_time")
  endTime      String        @map("end_time")
}

model Reservation {
  id              Int               @id @default(autoincrement())
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  shopId          Int               @map("shop_id")
  stylistId       Int?              @map("stylist_id")
  menuId          Int               @map("menu_id")
  menu            Menu              @relation(fields: [menuId], references: [id])
  userId          Int               @map("user_id")
  status          ReservationStatus @default(RESERVED)
  reservationDate DateTime          @map("reservation_date") @db.Timestamp(6)
  shop            Shop              @relation(fields: [shopId], references: [id], onDelete: Cascade)
  stylist         Stylist?          @relation(fields: [stylistId], references: [id])
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
}
